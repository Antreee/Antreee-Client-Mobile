import React, { useRef, useState } from "react";
import {
  Text,
  View,
  FlatList,
  ScrollView,
  ImageBackground,
  ActivityIndicator,
  Dimensions,
} from "react-native";
import styles from "../../../assets/styles/styles";
import { Icon } from "@ui-kitten/components";
import { Searchbar } from "react-native-paper";
import fontStyles from "../../../assets/styles/fontStyles";
import { LinearGradient } from "expo-linear-gradient";
import Carousel from "react-native-snap-carousel";
import Color from "../../assets/Color";
import RestaurantCard from "../../components/RestaurantCard";
import { useQuery } from "@apollo/client";
import { GET_RESTAURANTS } from "../../../config/queries";
import { animatedStyles, scrollInterpolator } from "../../components/animations";
import Svg, { Path } from "react-native-svg"

export default HomeScreen = (props, { navigation }) => {
  const { loading, error, data, refetch } = useQuery(GET_RESTAURANTS, {
    variables: {
      stringCoordinates: "98.628043,3.573613",
      search: "",
    },
  });

  const [state, setState] = useState({
    activeIndex: 2,
    carouselItems: [
      {
        title: "Ayam Bakar",
        text: "D'Raja",
        image: require("../../assets/imgTemplate/img01.jpg"),
      },
      {
        title: "Sate Kambing",
        text: "D'Raja",
        image: require("../../assets/imgTemplate/img02.jpg"),
      },
      {
        title: "Sop Kambing",
        text: "D'Raja",
        image: require("../../assets/imgTemplate/img03.jpg"),
      },
      {
        title: "Coto Makassar",
        text: "D'Raja",
        image: require("../../assets/imgTemplate/img04.jpg"),
      },
      {
        title: "Ikan Palumara",
        text: "D'Raja",
        image: require("../../assets/imgTemplate/img05.jpg"),
      },
    ],
  });

  function _renderItem({ item, index }) {
    return (
      <View
        style={{
          backgroundColor: "floralwhite",
          borderRadius: 20,
          height: 200,
          width: Dimensions.get("window").width - 125,
        }}
      >
        <ImageBackground
          source={item.image}
          style={{
            flex: 1,
            resizeMode: "cover",
            justifyContent: "flex-end",
          }}
          imageStyle={{ borderRadius: 20 }}
        >
          <View
            style={{
              backgroundColor: "rgba(0,0,0,0.5)",
              flexDirection: "column",
              justifyContent: "space-between",
              alignItems: "center",
              borderBottomRightRadius: 20,
              borderBottomLeftRadius: 20,
              paddingBottom: 10,
            }}
          >
            <Text style={{ fontSize: 30, color: Color.light }}>{item.title}</Text>
            <Text style={{ color: Color.light }}>{item.text}</Text>
          </View>
        </ImageBackground>
      </View>
    );
  }

  let carouselRef = useRef();
  const width = Dimensions.get("window").width;

  return (
    <>
      <View style={styles.container}>
        {/* Header */}
        <ScrollView>
          <View style={styles.headerApp}>
            <LinearGradient
              colors={["#E02401", "#FF8080", "transparent"]}
              style={styles.background}
            />
            <Icon name="smiling-face-outline" style={styles.appImg} fill="#FF8080" />
            <Svg
              xmlns="http://www.w3.org/2000/svg"
              width={98.438}
              height={25.098}
              {...props}
            >
              <Path
                stroke={Color.light}
                fill={Color.light}
                d="M80.225 7.495v.183l.268-1.33h3.601L82.3 14.844a2.597 2.597 0 0 0-.096.506 3.227 3.227 0 0 0-.014.3q0 1.074 1.025 1.074a1.356 1.356 0 0 0 .788-.259q.193-.134.375-.339a2.84 2.84 0 0 0 .082-.098 3.229 3.229 0 0 0 .346-.532q.141-.266.261-.59a7.182 7.182 0 0 0 .175-.538 11.639 11.639 0 0 0-.051.257q-.071.378-.107.718a6.277 6.277 0 0 0-.038.661 5.286 5.286 0 0 0 .012.356q.084 1.241.77 1.926a2.281 2.281 0 0 0 1.097.617 3.27 3.27 0 0 0 .795.091 4.39 4.39 0 0 0 .141-.002 3.831 3.831 0 0 0 1.275-.254 3.733 3.733 0 0 0 .873-.485 4.898 4.898 0 0 0 .714-.65l-.306 1.343q-1.063.334-1.85.742a6.513 6.513 0 0 0-.896.551q-1.331 1.014-1.331 2.43a2.87 2.87 0 0 0 .031.429 2.199 2.199 0 0 0 .189.627q.22.457.61.763a2.247 2.247 0 0 0 .298.209 2.607 2.607 0 0 0 .575.248 3.428 3.428 0 0 0 .341.084 3.97 3.97 0 0 0 .752.069 5.303 5.303 0 0 0 1.012-.092 3.806 3.806 0 0 0 1.588-.689 4.063 4.063 0 0 0 .709-.685q.466-.572.78-1.354a8.018 8.018 0 0 0 .415-1.428l.379-1.807q1.44-.366 2.417-1.245 1.33-1.208 2.002-3.43h-1.05q-.489 1.562-1.258 2.405-.708.781-1.892 1.172l2.478-11.597h-3.601l-1.745 8.179a6.422 6.422 0 0 1-.184.492q-.124.295-.266.532a2.768 2.768 0 0 1-.319.44q-.525.586-1.184.586-.403 0-.586-.341a1.033 1.033 0 0 1-.085-.197q-.038-.122-.057-.269a2.329 2.329 0 0 1-.017-.291q0-.33.073-.635l1.795-8.496h-3.602l-1.696 8.02h1.05q-.672 1.904-1.624 3.015-.806.916-1.819 1.318a4.262 4.262 0 0 1-1.575.293q-1.04 0-1.665-.557a2.027 2.027 0 0 1-.025-.022 2.176 2.176 0 0 1-.529-.773q-.171-.41-.234-.943a8.098 8.098 0 0 1-.634.792q-.357.391-.732.679a4.749 4.749 0 0 1-.123.092 3.693 3.693 0 0 1-2.234.732 3.718 3.718 0 0 1-1.051-.141 2.872 2.872 0 0 1-1.256-.75q-1.026-1.05-1.026-3.125a9.811 9.811 0 0 1 .08-1.225 11.802 11.802 0 0 1 .097-.63 12.073 12.073 0 0 1 .519-1.929 10.727 10.727 0 0 1 .842-1.804 7.966 7.966 0 0 1 1.294-1.663 5.484 5.484 0 0 1 1.626-1.102 4.93 4.93 0 0 1 1.975-.399 4.759 4.759 0 0 1 .53.027q.626.071.99.321a1.268 1.268 0 0 1 .304.286 1.036 1.036 0 0 1 .203.635zM2.161 18.848 5.92 1.721a6.067 6.067 0 0 0-1.322.648 4.576 4.576 0 0 0-1.272 1.238 4.911 4.911 0 0 0-.769 1.919 6.697 6.697 0 0 0-.103 1.2 6.377 6.377 0 0 0 .053.839 5.032 5.032 0 0 0 .124.632q.15.567.403.952a2.179 2.179 0 0 0 .091.129q-1.611 0-2.368-.654a2.018 2.018 0 0 1-.589-.901Q0 7.228 0 6.568a5.674 5.674 0 0 1 .855-2.98 6.978 6.978 0 0 1 .195-.304A7.16 7.16 0 0 1 3.252 1.2a8.589 8.589 0 0 1 .52-.296A8.285 8.285 0 0 1 7.593 0q.493 0 .882.059A3.985 3.985 0 0 1 8.6.08q.372.068.821.213a9.47 9.47 0 0 1 .149.049l3.015 13.379L15.381.147h2.429l-4.077 18.701h-3.455L7.385 6.446 4.529 18.848H2.161zm57.959 0 3.393-15.906 3.699-.488-1.77 8.349a3.224 3.224 0 0 0 1.402-.448q.423-.246.83-.626a5.766 5.766 0 0 0 .026-.024 6.145 6.145 0 0 0 1.196-1.569 7.617 7.617 0 0 0 .354-.751 7.028 7.028 0 0 0 .562-2.734 4.882 4.882 0 0 0-.109-1.062 3.386 3.386 0 0 0-.611-1.343 2.603 2.603 0 0 0-.943-.717 3.031 3.031 0 0 0-.046-.021 3.027 3.027 0 0 0-.735-.212 4.103 4.103 0 0 0-.657-.051 9.506 9.506 0 0 0-1.435.104 7.293 7.293 0 0 0-1.281.311 6.058 6.058 0 0 0-1.354.657 5.244 5.244 0 0 0-.69.54 4.988 4.988 0 0 0-1.248 1.846 5.771 5.771 0 0 0-.028.07 6.521 6.521 0 0 0-.372 1.529 8.309 8.309 0 0 0-.061 1.022 5.816 5.816 0 0 0 .018.479q.038.455.153.767a1.407 1.407 0 0 0 .062.166 1.117 1.117 0 0 0 .06.114.386.386 0 0 1 .036.086.31.31 0 0 1 .013.085 5.42 5.42 0 0 1-.705-.042q-.777-.102-1.219-.451a1.553 1.553 0 0 1-.054-.044 1.79 1.79 0 0 1-.53-.788q-.166-.466-.166-1.104a3.925 3.925 0 0 1 .301-1.492 4.542 4.542 0 0 1 .053-.125 5.828 5.828 0 0 1 .625-1.074 7.059 7.059 0 0 1 .376-.471 8.092 8.092 0 0 1 .952-.93 9.672 9.672 0 0 1 .507-.394q.848-.617 1.837-1.068a10.651 10.651 0 0 1 2.456-.785 9.15 9.15 0 0 1 1.67-.155 8.994 8.994 0 0 1 1.759.162q1.063.212 1.886.702a4.893 4.893 0 0 1 .847.637 4.296 4.296 0 0 1 1.056 1.551 5.028 5.028 0 0 1 .348 1.867 6.182 6.182 0 0 1-.406 2.181 7.125 7.125 0 0 1-.088.224q-.495 1.196-1.422 2.136-.977 1.001-2.326 1.581a7.194 7.194 0 0 1-2.275.552 8.62 8.62 0 0 1-.697.028h-.135l-1.525 7.129H60.12zm-33.973-4.48 1.697-8.02h3.601l-1.794 8.496q-.073.378-.073.708a2.08 2.08 0 0 0 .029.368q.116.639.682.657a1.046 1.046 0 0 0 .033 0 1.471 1.471 0 0 0 .895-.307 2.216 2.216 0 0 0 .338-.315q.431-.514.756-1.544a9.263 9.263 0 0 0 .013-.043l1.697-8.02h3.601l-1.794 8.496a2.597 2.597 0 0 0-.097.506 3.227 3.227 0 0 0-.013.3 1.693 1.693 0 0 0 .017.25q.047.316.225.468a.523.523 0 0 0 .002.002q.234.199.738.207a2.69 2.69 0 0 0 .043 0 1.504 1.504 0 0 0 .943-.335 2.23 2.23 0 0 0 .302-.287q.37-.417.628-1.114a6.292 6.292 0 0 0 .154-.473h1.049q-.671 1.904-1.623 3.015-.806.916-1.819 1.318a4.262 4.262 0 0 1-1.575.293 3.129 3.129 0 0 1-.715-.077 2.127 2.127 0 0 1-.994-.521 2.23 2.23 0 0 1-.521-.769q-.134-.318-.205-.709a4.55 4.55 0 0 1-.043-.292 7.176 7.176 0 0 1-.672.916q-.585.671-1.256 1.037a3.451 3.451 0 0 1-1.211.381 4.388 4.388 0 0 1-.56.034 3.27 3.27 0 0 1-.795-.091 2.281 2.281 0 0 1-1.097-.617q-.685-.685-.769-1.926a5.286 5.286 0 0 1-.012-.356 6.277 6.277 0 0 1 .037-.661q.036-.34.107-.718a11.639 11.639 0 0 1 .051-.257zm0 0h.855a12.785 12.785 0 0 1-1.251 1.772 9.686 9.686 0 0 1-1.471 1.414 6.965 6.965 0 0 1-2.475 1.229 6.623 6.623 0 0 1-1.676.211 5.873 5.873 0 0 1-1.119-.1q-.641-.124-1.141-.404a3.038 3.038 0 0 1-.584-.423q-.884-.823-1.032-2.381a6.954 6.954 0 0 1-.03-.659q0-.763.15-1.694a14.893 14.893 0 0 1 .003-.015 12.643 12.643 0 0 1 .458-1.88 10.884 10.884 0 0 1 .872-1.99q.531-.939 1.239-1.66a5.421 5.421 0 0 1 3.935-1.659 6.834 6.834 0 0 1 .094-.001 5.048 5.048 0 0 1 .792.058q.929.148 1.429.675.455.486.525 1.34a3.947 3.947 0 0 1 .012.32q0 1.062-.463 1.996a5.382 5.382 0 0 1-1.282 1.654q-.818.708-1.856 1.129a6.881 6.881 0 0 1-2.148.494q-.055.574-.061.928a4.879 4.879 0 0 0 0 .073 5.059 5.059 0 0 0 .029.563q.087.774.435 1.122a1.172 1.172 0 0 0 .416.268q.345.138.858.146a4.123 4.123 0 0 0 .069.001q1.355 0 2.478-.733a5.928 5.928 0 0 0 .791-.61 6.67 6.67 0 0 0 .124-.116 15.146 15.146 0 0 0 .35-.348q.309-.316.675-.72zm22.217 0h.855a12.785 12.785 0 0 1-1.252 1.772 9.686 9.686 0 0 1-1.47 1.414 6.965 6.965 0 0 1-2.475 1.229 6.623 6.623 0 0 1-1.676.211 5.873 5.873 0 0 1-1.119-.1q-.641-.124-1.142-.404a3.038 3.038 0 0 1-.583-.423q-.884-.823-1.032-2.381a6.954 6.954 0 0 1-.03-.659q0-.763.15-1.694a14.893 14.893 0 0 1 .003-.015 12.643 12.643 0 0 1 .457-1.88 10.884 10.884 0 0 1 .873-1.99q.531-.939 1.239-1.66a5.421 5.421 0 0 1 3.935-1.659 6.834 6.834 0 0 1 .093-.001 5.048 5.048 0 0 1 .793.058q.929.148 1.429.675.455.486.525 1.34a3.947 3.947 0 0 1 .012.32q0 1.062-.464 1.996a5.382 5.382 0 0 1-1.281 1.654q-.818.708-1.856 1.129a6.881 6.881 0 0 1-2.148.494q-.055.574-.061.928a4.879 4.879 0 0 0 0 .073 5.059 5.059 0 0 0 .029.563q.087.774.435 1.122a1.172 1.172 0 0 0 .415.268q.346.138.858.146a4.123 4.123 0 0 0 .069.001q1.355 0 2.478-.733a5.928 5.928 0 0 0 .792-.61 6.67 6.67 0 0 0 .124-.116 15.146 15.146 0 0 0 .35-.348q.309-.316.675-.72zm-.952 4.48 2.649-12.5h3.601l-.317 1.55q.704-.624 1.193-.949a4.398 4.398 0 0 1 .198-.125q.83-.476 1.624-.476a1.828 1.828 0 0 1 .621.101 1.569 1.569 0 0 1 .673.473 1.722 1.722 0 0 1 .329.592q.11.335.11.714 0 .342-.11.659a1.758 1.758 0 0 1-.329.574 1.797 1.797 0 0 1-.59.426 2.103 2.103 0 0 1-.002.001q-.348.159-.775.159a1.607 1.607 0 0 1-.207-.013q-.103-.013-.189-.041a.717.717 0 0 1-.129-.056q-.196-.11-.305-.318a1.842 1.842 0 0 1-.091-.229 1.485 1.485 0 0 1-.044-.173q-.103-.496-.207-.676a.486.486 0 0 0-.012-.02.275.275 0 0 0-.174-.113.442.442 0 0 0-.095-.009 2.089 2.089 0 0 0-.415.039 1.494 1.494 0 0 0-.476.18 3.369 3.369 0 0 0-.247.166q-.253.184-.574.47a12.787 12.787 0 0 0-.107.097l-2.002 9.497h-3.601zm31.384-4.48 1.197-5.64a.674.674 0 0 0-.009-.106q-.009-.052-.025-.109a1.397 1.397 0 0 0-.021-.072q-.055-.164-.153-.311a.956.956 0 0 0-.637-.342 1.388 1.388 0 0 0-.181-.012 1.576 1.576 0 0 0-.726.182 2.064 2.064 0 0 0-.244.148 3.179 3.179 0 0 0-.47.408q-.201.209-.39.472a5.284 5.284 0 0 0-.025.035q-.733 1.062-1.209 2.771a11.369 11.369 0 0 0-.326 1.472 10.537 10.537 0 0 0-.003.024q-.107.714-.11 1.298a6.593 6.593 0 0 0 0 .038q0 .99.293 1.471a1.035 1.035 0 0 0 .171.214.829.829 0 0 0 .157.133.653.653 0 0 0 .197.087 1.585 1.585 0 0 0 .221.038 2.122 2.122 0 0 0 .218.01q.281 0 .592-.146.312-.147.604-.415a3.001 3.001 0 0 0 .752-1.194 3.857 3.857 0 0 0 .127-.454zm-58.618-1.77a3.296 3.296 0 0 0 1.231-.339 3.833 3.833 0 0 0 .124-.064q.659-.354 1.172-.928a4.58 4.58 0 0 0 .806-1.312q.293-.726.293-1.483a2.871 2.871 0 0 0-.013-.276q-.027-.279-.112-.457a.782.782 0 0 0-.016-.03.469.469 0 0 0-.337-.249.734.734 0 0 0-.145-.014q-.452 0-.909.44-.458.439-.885 1.208a9.822 9.822 0 0 0-.417.872 12.64 12.64 0 0 0-.291.764 13.449 13.449 0 0 0-.501 1.868zm22.217 0a3.296 3.296 0 0 0 1.231-.339 3.833 3.833 0 0 0 .124-.064q.659-.354 1.172-.928a4.58 4.58 0 0 0 .806-1.312q.293-.726.293-1.483a2.871 2.871 0 0 0-.013-.276q-.027-.279-.113-.457a.782.782 0 0 0-.015-.03.469.469 0 0 0-.338-.249.734.734 0 0 0-.144-.014q-.452 0-.909.44-.458.439-.885 1.208a9.822 9.822 0 0 0-.417.872 12.64 12.64 0 0 0-.291.764 13.449 13.449 0 0 0-.501 1.868zm47.62 8.325.146-.72a11.154 11.154 0 0 0-.65.266q-.659.298-1.047.601a2.461 2.461 0 0 0-.376.345q-.201.231-.293.482a1.249 1.249 0 0 0-.075.43.862.862 0 0 0 .042.276.735.735 0 0 0 .165.273.761.761 0 0 0 .501.261 1.087 1.087 0 0 0 .134.008.628.628 0 0 0 .291-.078q.204-.106.421-.358a2.902 2.902 0 0 0 .094-.114q.415-.537.647-1.672z"
              />
            </Svg>
          </View>
          {/* ======= */}

          {/* SEARCH */}
          <View style={styles.searchWrap}>
            <Searchbar
              placeholder="Search Restaurant"
              onChangeText={(value) =>
                refetch({
                  stringCoordinates: "98.628043,3.573613",
                  search: value,
                })
              }
              style={styles.search}
              inputStyle={fontStyles.smallLightFont}
            />
          </View>
          {/* =========== */}
          {/* Carosel */}
          <View style={styles.contentWrap}>
            <View style={styles.titleWrap}>
              <View style={styles.redBox} />
              <View style={styles.contentTitle}>
                <Text style={fontStyles.darkFontBold}>Featured</Text>
              </View>
            </View>
            <View style={styles.carouselWrap}>
              <Carousel
                layout={"default"}
                ref={carouselRef}
                data={state.carouselItems}
                sliderWidth={width}
                itemWidth={Math.round(width * 0.7)}
                useScrollView={true}
                scrollInterpolator={scrollInterpolator}
                slideInterpolatedStyle={animatedStyles}
                inactiveSlideShift={0}
                renderItem={_renderItem}
                onSnapToItem={(index) => setState({ ...state, activeIndex: index })}
              />
            </View>
          </View>
          {/* =========== */}
          {/* Restaurant Near You */}
          <View style={styles.contentMenuWrap}>
            <View style={styles.titleWrap}>
              <View style={styles.redBox} />
              <View style={styles.contentTitle}>
                <Text style={fontStyles.darkFontBold}>Restaurants Near You</Text>
              </View>
            </View>
            {loading && (
              <>
                <View
                  style={{
                    height: 40,
                  }}
                >
                  <ActivityIndicator size="small" color={Color.red} />
                </View>
              </>
            )}
            {data &&
              data.restaurants.map((el) => {
                return <RestaurantCard key={el._id} resto={el} navigation={navigation} />;
              })}
          </View>
          {/* ============== */}
        </ScrollView>
      </View>
    </>
  );
};
